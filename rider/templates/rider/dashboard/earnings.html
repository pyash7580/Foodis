{% extends 'rider/base.html' %}

{% block title %}Earnings & Payouts{% endblock %}

{% block content %}
<div style="margin-bottom: 24px;">
    <a href="{% url 'rider:dashboard' %}" style="text-decoration: none; color: var(--primary); font-weight: 600;">← Back
        to Dashboard</a>
    <h2 style="margin: 16px 0 0;">Earnings & Payouts</h2>
</div>

<!-- Summary Cards -->
<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 24px;">
    <div
        style="background: white; border: 1px solid var(--border); padding: 16px; border-radius: 12px; text-align: center;">
        <p style="margin: 0; font-size: 12px; color: var(--muted);">Today's Earnings</p>
        <h3 style="margin: 8px 0 0; font-size: 20px;">₹{{ daily_earnings }}</h3>
    </div>
    <div
        style="background: white; border: 1px solid var(--border); padding: 16px; border-radius: 12px; text-align: center;">
        <p style="margin: 0; font-size: 12px; color: var(--muted);">Weekly Summary</p>
        <h3 style="margin: 8px 0 0; font-size: 20px;">₹{{ weekly_earnings }}</h3>
    </div>
</div>

<div style="background: #1A1A1A; color: white; padding: 24px; border-radius: 12px; margin-bottom: 24px;">
    <p style="margin: 0; font-size: 14px; opacity: 0.8;">Withdrawable Balance</p>
    <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 8px;">
        <h3 style="margin: 0; font-size: 32px;">₹{{ rider.wallet_balance }}</h3>
        {% if rider.wallet_balance > 0 %}
        <form action="{% url 'rider:request_payout' %}" method="POST">
            {% csrf_token %}
            <button type="submit" class="btn btn-primary"
                style="margin-top: 0; padding: 8px 16px; font-size: 14px;">Request Payout</button>
        </form>
        {% endif %}
    </div>
</div>

<!-- Tabs (Simple) -->
<div style="margin-bottom: 20px; border-bottom: 1px solid var(--border); display: flex; gap: 20px;">
    <div style="padding-bottom: 10px; border-bottom: 2px solid var(--primary); font-weight: 600;">Order History</div>
</div>

<div
    style="background: white; border: 1px solid var(--border); border-radius: 12px; overflow: hidden; margin-bottom: 32px;">
    {% if earnings %}
    {% for earning in earnings %}
    <div
        style="padding: 16px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center;">
        <div>
            <p style="margin: 0; font-weight: 600;">Order #{{ earning.order_id }}</p>
            <p style="margin: 4px 0 0; font-size: 12px; color: var(--muted);">{{ earning.timestamp|date:"d M, Y - H:i"
                }} • {{ earning.get_transaction_type_display }}</p>
        </div>
        <div style="font-weight: 700; color: #059669;">
            +₹{{ earning.amount }}
        </div>
    </div>
    {% endfor %}
    {% else %}
    <div style="padding: 40px; text-align: center; color: var(--muted);">
        No earnings recorded yet.
    </div>
    {% endif %}
</div>

{% if payouts %}
<h3 style="margin: 0 0 16px; font-size: 18px;">Recent Payouts</h3>
<div style="background: white; border: 1px solid var(--border); border-radius: 12px; overflow: hidden;">
    {% for payout in payouts %}
    <div
        style="padding: 16px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center;">
        <div>
            <p style="margin: 0; font-weight: 600;">₹{{ payout.amount }} Payout</p>
            <p style="margin: 4px 0 0; font-size: 12px; color: var(--muted);">{{ payout.requested_at|date:"d M, Y" }}
            </p>
        </div>
        <div>
            <span style="display: inline-block; padding: 2px 8px; border-radius: 4px; font-size: 11px; font-weight: 600; 
                    {% if payout.status == 'PAID' %}background: #D1FAE5; color: #059669;
                    {% elif payout.status == 'PENDING' %}background: #FEF3C7; color: #92400E;
                    {% else %}background: #FEE2E2; color: #991B1B;{% endif %}">
                {{ payout.status }}
            </span>
        </div>
    </div>
    {% endfor %}
</div>
{% endif %}

{% endblock %}